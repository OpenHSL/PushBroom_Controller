# PushBroom_Controller

Программное обеспечение для управления процессом съёмки щелевого гиперспектрометра и получения набора кадров, содержащих спектральную развёртку. Дальнейшее формирование, обработка и анализ ГСИ проводятся с помощью платформы [OpenHSL](https://github.com/OpenHSL/OpenHSL)
Данная версия программы предназначения для работы с гиперспектральным микроскопом на базе микрокомпьюетра Raspberry Pi4 и сенсора Basler.
Конечный пользователь может расширить сферу применения данного ПО для любых щелевых гиперспектрометров, оборудованных шаговым механизмом при доработке модулей, реализующих API сенсора и шагового механизма,  с учётом API реализованного здесь.


Перечень направлений применения данного ПО:
- Экологическая безопасность (определение болезней растений, индекса зелёной массы, влажности почвы, концентрации удобрений в почве);
- Пищевая безопасность;
- Сортировка отходов по различным материалам;
- Медицина (экспресс диагностика онкозаболеваний, патологий сердца и кровообращения, заболеваний сетчатки, мастэктомии, неинвазивная диагностика заболеваний кожи и т.д.);
- Промышленность (определение качества сырья и готовой продукции, определение пород и их химического состава);
- и т.д.

## Минимальные технические требования
- Микрокомпьютер Raspberry Pi4
- Щелевой гиперспектрометр на базе сенсора Basler 
- ОС: RaspOS
- Python 3.9

## Установка
Установка По производится командой `git clone https://github.com/OpenHSL/PushBroom_Controller.git`

Установка всех требуемых для запуска пакетов производится командой `pip install -r requirements.txt`

## Запуск программы

Для запуска ПО в режиме CLI необходимо указать требуемые параметры в файле *settings.py*:
- number_of_steps количество шагов для шагового механизма;
- exposure выдержка в мс (подбирается экспериментально, оценивая освещенность сцены);
- gain коэффициент усиления сигнала (подбирается экспериментально, оценивая освещенность сцены);
- direction направление движения шагового механизма (0 и 1 отвечают за прямое движение и обратное);
- path_to_save путь к папке сохранения;
- mode режим работы шагового механизма (0 или 1 отвечают за полный шаг или 1/2 шага).

После чего выполнить команду:

`python main.py`

Для запуска ПО в режиме GUI необходимо выполнить команду:

`python micro_app.py`

## Примеры полученных и сформированных данных:

Нижепредставленные наборы даных получены данным ПО, а в дальнейшем обработаны и сформированы с помощью платформы с открытым исходным кодом [OpenHSL](https://github.com/OpenHSL/OpenHSL)

1) [Неокрашенный микропрепарат](https://www.kaggle.com/datasets/openhsl/hyperdataset-unstained-tissue-microslide)
2) [Окрашенный микропрепарат](https://www.kaggle.com/datasets/openhsl/hyperdataset-stained-microscope)
3) [Растительный микропрепарат](https://www.kaggle.com/datasets/openhsl/hyperdata-plant-microscope) 

## Рекомендации к формированию наборов данных при помощи данного ПО:

Для получения качественных наборов данных требуется соблюдать следующие условия:

1) Выбор источника освещения (если съёмка проводится под искусственным освещением) должен обуславливаться спектром излучения источника. Рекомендуется использовать галогеновые лампы, имеющие непрерывный спектр излучения.
2) Крайне желательно добиться рассеянного источника освещения, а не сфокусированного на объекте съёмки во избежание неоднородности освещения объекта съёмки.
3) Подбор времени экспозиции и коэффициента усиления сигнала требуется подбирать каждый раз перед съёмкой, опираясь на получаемые кадры с устройства. Должны отсутствовать пересвет на целевой области изображения, так и недостотаточная яркость.
4) Желательно проводить съёмку стационарных объектов, которые минимально подвержены изменению положения в пространстве в течении процесса съёмки.
5) Выбор формата хранения ГСИ должен обуславливаться дальнейшим удобством пользования, включая хранение на ПЗУ и его передачу на другое устройство.
6) Разметку ГСИ лучше всего проводить с привлечением специалиста из области, для которой производится съёмка ГСИ, во избежание ошибок в полученных масках. 
